# Employee Merch Store

Employee Merch Store – это API-сервис для управления учетными записями пользователей, их балансом монет, историей транзакций, переводами монет и покупкой фирменного мерча. Приложение написано на Go и использует PostgreSQL в качестве базы данных.

## Запуск проекта

### Использование Docker

Проект можно запустить с помощью Docker Compose:
```sh
cd build
docker-compose up --build
```
Перед запуском рекомендуется проверить конфигурацию.

### Локальный запуск

1. Установите необходимые зависимости:
   ```sh
   go mod tidy
   ```
2. Запустите сервер:
   ```sh
   go run cmd/main.go
   ```

## Тестирование

### Unit-тесты
- Тестами покрыта основная бизнес-логика. Файлы тестов находятся в `internal/service`.
- Для мокирования использовался `github.com/stretchr/testify/mock`.

Запуск unit-тестов:
```sh
go test ./...
```

### E2E-тесты
- Для интеграционного тестирования использовалась стандартная библиотека `net/http/httptest`.
- Перед запуском тестов необходимо перенести файл из `./test` в корневую директорию (`./`). И так же выделить тестовую БД

## Производительность

Были проведено нагрузочное тестирование с помощью `wrk`. Основные результаты:
- Обнаружены гонки данных при авторизации, особенно при создании пользователей.
- Для решения проблемы был внедрен in-memory кэш, однако он покрывает только авторизацию.
- Основное время обработки запросов сервер проводит в ожидании ответа от базы данных.
- Добавлены индексы для оптимизации запросов, но значительного прироста производительности не достигнуто.

## Дополнительно

- В коде частично применены принципы чистой архитектуры, но в некоторых местах часть бизнес-логики вынесена в слой данных.
- `.golangci.yaml` добавлен в репозиторий, но его работоспособность не проверялась.


## Архитектура

		├── api
		│   ├── handlers.go        # Обработчики HTTP-запросов
		│   └── routes.go          # Определения маршрутов
		├── cmd
		│   └── server
		│       └── main.go        # Главный файл приложения
		├── config
		│   ├── config.go          
		│   └── config.yml         # Файл конфигурации
		├── internal
		│   ├── cache/
		│   │   └── cache.go       # Кэширование
		│   ├── database/
		│   │   ├── bd.go          # Работа с базой данных
		│   │   └── migrations/    # Миграции базы данных
		│   ├── models
		│   │   ├── user.go        # Модели данных пользователей
		│   │   ├── ledger.go      # Модели данных транзакций
		│   │   └── merch.go       # Модели данных товаров
		│   ├── repository
		│   │   ├── user_repository.go  # Репозитории для работы с пользователями
		│   │   ├── ledger_repository.go  # Репозитории для работы с транзакциями
		│   │   └── merch_repository.go  # Репозитории для работы с товарами
		│   └── service
		│       ├── user_service.go  # Сервисы для работы с пользователями
		│       ├── ledger_service.go  # Сервисы для работы с транзакциями
		│       └── merch_service.go  # Сервисы для работы с товарами
		├── build
		│   ├── docker-compose.yml
		│   └── Dockerfile     
		├── docs
		├── go.mod               
		├── go.sum               
		└── test
		    └── integration_test.go  # Интеграционные тесты

На схеме представлены не все файлы

## Заметки

Приступив к выполнению тестового задания, я столкнулся с тем, что на его реализацию у меня было всего 2,5 дня, что видно по коммитам. Так как я не ожидал, что сообщение придёт от VCV, сообщения было помечено как "спам". Тем не менее, я решил попробовать реализовать решение в рамках доступного времени. В процессе работы я старался придерживаться принципов чистой архитектуры, но в итоге оказалось, что слой данных организован не лучшим образом, а транзакции перегружены. Это привело к тому, что мой код не достиг требуемой производительности. Так же в ходе работы появилось много лишних сущностей, что только усложнило дальнейшую разработку. Кроме того, часть бизнес-логики оказалась размытой по всему проекту, что усложнило дальнейшую оптимизацию. Несмотря на попытки исправить ситуацию, полностью справиться с задачей у меня не получилось.